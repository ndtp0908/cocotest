@model IEnumerable<coco.Models.Storage>

@{
    ViewData["Title"] = "Sản phẩm";
}

<div class="text-center">
    <h1 class="display-4">Danh sách sản phẩm</h1>

    @if (Model == null || !Model.Any())
    {
        <p>⚠️ Hiện tại không có sản phẩm nào.</p>
    }
    else
    {
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Tên sản phẩm</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.ItemName</td>
                        <td class="price">@item.ItemPrice</td>
                        <td>@item.ItemAmount</td>
                        <td>
                            <button class="btn btn-primary btn-sm add-to-cart"
                                    data-id="@item.ItemId"
                                    data-name="@item.ItemName"
                                    data-price="@item.ItemPrice">
                                Thêm vào giỏ hàng
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

<!-- Bootstrap Toast Notification -->
<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="cartToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                🛒 Sản phẩm đã được thêm vào giỏ hàng!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Định dạng tiền tệ VND
        function formatCurrency(price) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price);
        }

        // Cập nhật giá sản phẩm theo định dạng tiền tệ
        document.querySelectorAll(".price").forEach(function (element) {
            let price = parseFloat(element.textContent);
            element.textContent = formatCurrency(price);
        });

        // Xử lý sự kiện "Thêm vào giỏ hàng"
        document.querySelectorAll(".add-to-cart").forEach(button => {
            button.addEventListener("click", function () {
                let itemId = this.getAttribute("data-id");
                let itemName = this.getAttribute("data-name");
                let itemPrice = parseFloat(this.getAttribute("data-price"));

                let cart = JSON.parse(localStorage.getItem("tempShopping")) || {};

                if (cart[itemId]) {
                    cart[itemId].itemAmount += 1;
                } else {
                    cart[itemId] = {
                        itemId: itemId,
                        itemName: itemName,
                        itemPrice: itemPrice,
                        itemAmount: 1
                    };
                }

                localStorage.setItem("tempShopping", JSON.stringify(cart));

                // Hiển thị toast Bootstrap
                let cartToast = new bootstrap.Toast(document.getElementById("cartToast"));
                document.querySelector("#cartToast .toast-body").textContent = `✅ ${itemName} đã được thêm vào giỏ hàng!`;
                cartToast.show();
            });
        });
    });
</script>
