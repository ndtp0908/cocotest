@{
    ViewData["Title"] = "Quản lý";
    Layout = "~/Areas/Admin/Views/Shared/AdminLayout.cshtml";
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Lỗi!</strong> @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-3">
            <ul class="list-group">            
                <li class="list-group-item">
                    <a href="#" class="nav-link" onclick="showTab('billManager')">Quản lý hóa đơn</a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="nav-link" onclick="showTab('productManager')">Quản lý sản phẩm</a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="nav-link" onclick="showTab('userManager')">Quản lý tài khoản</a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="nav-link" onclick="showTab('changePassword')">Đổi mật khẩu</a>
                </li>
            </ul>
        </div>
        <div class="col-md-9">
            <div id="billManager" class="tab-content">
                <h2>Quản lý hóa đơn</h2>
            </div>
            <div id="productManager" class="tab-content d-none">
                <h3>Quản lý sản phẩm</h3>
            </div>
            <div id="userManager" class="tab-content d-none">
                <h3>Quản lý tài khoản</h3>
            </div>
            <div id="changePassword" class="tab-content d-none">
                <h2>Đổi mật khẩu</h2>
                <form id="passwordForm" method="post" asp-controller="Admin" asp-action="ChangePassword">
                    <input type="hidden" name="userId" id="userId">
                    <div class="mb-3">
                        <label>Mật khẩu hiện tại:</label>
                        <input type="password" class="form-control" name="oldPassword">
                    </div>
                    <div class="mb-3">
                        <label>Mật khẩu mới:</label>
                        <input type="password" class="form-control" name="newPassword">
                    </div>
                    <div class="mb-3">
                        <label>Nhập lại mật khẩu mới:</label>
                        <input type="password" class="form-control" name="rePassword">
                    </div>
                    <button type="submit" class="btn btn-primary">Đổi mật khẩu</button>
                </form>
            </div>
        </div>
    </div>
</div>
</div>

<script>
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('d-none');
        });
        document.getElementById(tabId).classList.remove('d-none');
    }

    document.addEventListener("DOMContentLoaded", function () {
        const userData = localStorage.getItem("user");
        const user = JSON.parse(userData);
        console.log(user.userId)
        document.getElementById("userId").value = user.userId || "";
    });

    function loadUserData() {
        const userData = localStorage.getItem("user");
        if (userData) {
            const user = JSON.parse(userData);
            document.getElementById("userId").value = user.userId || "";
            document.getElementById("name").value = user.name || "";
            document.getElementById("userName").value = user.userName || "";
            document.getElementById("email").value = user.email || "";
            document.getElementById("phone").value = user.phone || "";
            document.getElementById("address").value = user.address || "";
            document.getElementById("gender").value = user.gender || "Nam";

            if (user.birthday) {
                let dateParts = user.birthday.split("/");
                if (dateParts.length === 3) {
                    let formattedDate = `${dateParts[2]}-${dateParts[0].padStart(2, '0')}-${dateParts[1].padStart(2, '0')}`;
                    document.getElementById("birthday").value = formattedDate;
                }
            }
        }
    }
</script>

